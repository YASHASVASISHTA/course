// Enhanced Course Data with Deep Content and Comprehensive MCQs
const courseData = {
  modules: [
    {
      id: 1,
      title: "Software Sales Fundamentals",
      icon: "fas fa-laptop-code",
      chapters: [
        {
          id: 1,
          title: "What Makes Software Sales Unique",
          duration: "25 min read",
          content: {
            lesson: `
                            <h1>What Makes Software Sales Unique</h1>
                            
                            <p>Software sales represents a fundamental shift from traditional product sales, requiring a unique blend of technical understanding, business acumen, and relationship-building skills. In the rapidly evolving Indian software market, understanding these distinctions is crucial for success.</p>
                            
                            <h2>The Intangible Nature Challenge</h2>
                            <p>Unlike physical products that customers can touch, feel, and examine, software exists in the digital realm. This intangibility creates several unique challenges that software sales professionals must navigate:</p>
                            
                            <ul>
                                <li><strong>Demonstration Dependency:</strong> Prospects cannot physically examine the product, making demos and trials critical for showcasing value</li>
                                <li><strong>Trust Building:</strong> Without tangible proof, building credibility becomes paramount through case studies, testimonials, and proof of concepts</li>
                                <li><strong>Value Articulation:</strong> Benefits must be clearly communicated through metrics, ROI calculations, and business impact scenarios</li>
                                <li><strong>Feature vs. Outcome Focus:</strong> Success requires shifting from feature lists to business outcome discussions</li>
                            </ul>
                            
                            <h2>Complex Decision-Making Ecosystems</h2>
                            <p>Software purchases in Indian enterprises typically involve multiple stakeholders, each with different priorities and concerns. Understanding this ecosystem is crucial:</p>
                            
                            <h3>Key Stakeholders in Indian Software Purchases</h3>
                            <ul>
                                <li><strong>End Users:</strong> Focus on usability, efficiency, and daily workflow impact</li>
                                <li><strong>IT Department:</strong> Concerned with integration, security, maintenance, and technical compatibility</li>
                                <li><strong>Finance Team:</strong> Evaluates cost-benefit analysis, budget allocation, and ROI projections</li>
                                <li><strong>Management:</strong> Looks at strategic alignment, competitive advantage, and long-term business impact</li>
                                <li><strong>Procurement:</strong> Handles vendor evaluation, contract negotiations, and compliance requirements</li>
                            </ul>
                            
                            <div class="indian-context">
                                <h3>Indian Market Specifics</h3>
                                <p>The Indian software market has unique characteristics that influence sales approaches:</p>
                                <ul>
                                    <li><strong>Cost Sensitivity:</strong> Indian businesses are highly price-conscious, requiring strong ROI justification</li>
                                    <li><strong>Relationship-Centric:</strong> Personal relationships and trust play a crucial role in decision-making</li>
                                    <li><strong>Gradual Adoption:</strong> Many organizations prefer phased implementations over big-bang approaches</li>
                                    <li><strong>Local Support Expectations:</strong> Strong preference for vendors with local presence and support capabilities</li>
                                </ul>
                            </div>
                            
                            <h2>Extended Sales Cycles</h2>
                            <p>Software sales cycles in India typically range from 3-18 months, significantly longer than traditional product sales. Several factors contribute to this extended timeline:</p>
                            
                            <h3>Factors Influencing Sales Cycle Length</h3>
                            <ul>
                                <li><strong>Budget Approval Processes:</strong> Multiple approval layers in Indian organizations</li>
                                <li><strong>Technical Evaluation:</strong> Extensive testing, integration assessments, and security reviews</li>
                                <li><strong>Stakeholder Alignment:</strong> Time required to get all decision-makers on the same page</li>
                                <li><strong>Risk Mitigation:</strong> Conservative approach to new technology adoption</li>
                                <li><strong>Vendor Comparison:</strong> Thorough evaluation of multiple solutions and providers</li>
                            </ul>
                            
                            <h2>Recurring Revenue Models</h2>
                            <p>Most software solutions operate on subscription or recurring revenue models, fundamentally changing the sales approach:</p>
                            
                            <h3>SaaS Sales Considerations</h3>
                            <ul>
                                <li><strong>Customer Lifetime Value (CLV):</strong> Focus shifts from one-time transactions to long-term relationships</li>
                                <li><strong>Churn Prevention:</strong> Ongoing customer success becomes as important as initial sales</li>
                                <li><strong>Expansion Opportunities:</strong> Upselling and cross-selling become continuous activities</li>
                                <li><strong>Usage-Based Pricing:</strong> Understanding customer usage patterns for optimal pricing strategies</li>
                            </ul>
                            
                            <div class="case-study">
                                <h3>Case Study: Transforming Traditional Sales Approach</h3>
                                <p><strong>Background:</strong> Rajesh, a sales professional from Mumbai, transitioned from selling manufacturing equipment to CRM software. His initial approach of focusing on product features and one-time pricing failed to resonate with prospects.</p>
                                
                                <p><strong>The Challenge:</strong> Traditional product sales techniques weren't working in the software space. Prospects seemed interested but weren't converting.</p>
                                
                                <p><strong>The Transformation:</strong></p>
                                <ul>
                                    <li>Shifted focus from features to business outcomes</li>
                                    <li>Developed ROI calculators specific to Indian market conditions</li>
                                    <li>Created industry-specific demo scenarios</li>
                                    <li>Built relationships with multiple stakeholders, not just the primary contact</li>
                                    <li>Implemented a consultative selling approach</li>
                                </ul>
                                
                                <p><strong>Results:</strong> Within six months, Rajesh's conversion rate improved by 300%, and his average deal size increased by 150%. He became the top performer in his team by adapting to software sales fundamentals.</p>
                            </div>
                            
                            <h2>Technical Integration Complexity</h2>
                            <p>Software sales often involve complex technical considerations that don't exist in traditional product sales:</p>
                            
                            <ul>
                                <li><strong>System Integration:</strong> How the software fits into existing technology infrastructure</li>
                                <li><strong>Data Migration:</strong> Moving existing data to new systems safely and efficiently</li>
                                <li><strong>Customization Requirements:</strong> Adapting software to specific business processes</li>
                                <li><strong>Security Compliance:</strong> Meeting industry-specific security and regulatory requirements</li>
                                <li><strong>Scalability Planning:</strong> Ensuring the solution can grow with the business</li>
                            </ul>
                            
                            <div class="practical-tips">
                                <h3>Practical Tips for Software Sales Success</h3>
                                <ul>
                                    <li><strong>Develop Technical Fluency:</strong> Understand your product's technical capabilities without becoming overly technical</li>
                                    <li><strong>Create Business Cases:</strong> Always tie features to business outcomes and ROI</li>
                                    <li><strong>Build Multi-Level Relationships:</strong> Engage with technical, business, and executive stakeholders</li>
                                    <li><strong>Use Social Proof:</strong> Leverage case studies, testimonials, and reference customers effectively</li>
                                    <li><strong>Master the Demo:</strong> Perfect your product demonstration skills for different audiences</li>
                                </ul>
                            </div>
                            
                            <h2>The Consultative Selling Imperative</h2>
                            <p>Successful software sales professionals act more as consultants than traditional salespeople. This approach involves:</p>
                            
                            <ul>
                                <li><strong>Problem Discovery:</strong> Deep understanding of customer challenges and pain points</li>
                                <li><strong>Solution Design:</strong> Crafting customized solutions that address specific business needs</li>
                                <li><strong>Value Quantification:</strong> Helping customers understand and measure the business impact</li>
                                <li><strong>Implementation Planning:</strong> Guiding customers through the adoption process</li>
                                <li><strong>Ongoing Partnership:</strong> Maintaining relationships beyond the initial sale</li>
                            </ul>
                            
                            <div class="key-takeaways">
                                <h3>Key Takeaways</h3>
                                <ul>
                                    <li>Software sales requires a fundamentally different approach than traditional product sales</li>
                                    <li>Success depends on building trust and credibility in the absence of tangible products</li>
                                    <li>Multiple stakeholders with different priorities must be addressed simultaneously</li>
                                    <li>Extended sales cycles require patience, persistence, and systematic follow-up</li>
                                    <li>Recurring revenue models shift focus to long-term customer relationships</li>
                                    <li>Technical integration complexity requires deeper product knowledge and consultative skills</li>
                                    <li>Indian market specifics like cost sensitivity and relationship focus must be considered</li>
                                </ul>
                            </div>
                        `,
          },
          quiz: [
            {
              question: "What is the primary challenge of selling intangible software products?",
              options: [
                "Higher prices compared to physical products",
                "Difficulty in demonstrating value without physical examination",
                "Longer delivery times",
                "More complex manufacturing processes",
              ],
              correct: 1,
              explanation:
                "The intangible nature of software makes it difficult for prospects to evaluate the product without demonstrations, trials, or detailed explanations of benefits.",
            },
            {
              question:
                "In Indian software sales, which stakeholder is typically most concerned with ROI and budget allocation?",
              options: ["End users", "IT department", "Finance team", "Procurement team"],
              correct: 2,
              explanation:
                "The finance team focuses on cost-benefit analysis, budget allocation, and ROI projections when evaluating software purchases.",
            },
            {
              question: "What is the typical range of software sales cycles in India?",
              options: ["1-3 months", "3-18 months", "6-24 months", "1-6 months"],
              correct: 1,
              explanation:
                "Software sales cycles in India typically range from 3-18 months due to complex decision-making processes, multiple stakeholders, and thorough evaluation requirements.",
            },
            {
              question: "Which characteristic is most unique to the Indian software market?",
              options: [
                "High technology adoption rate",
                "Cost sensitivity and strong ROI requirements",
                "Preference for cloud-only solutions",
                "Quick decision-making processes",
              ],
              correct: 1,
              explanation:
                "Indian businesses are highly cost-conscious and require strong ROI justification, making cost sensitivity a defining characteristic of the market.",
            },
            {
              question: "What does Customer Lifetime Value (CLV) represent in SaaS sales?",
              options: [
                "The initial purchase amount",
                "The total revenue from a customer over their entire relationship",
                "The cost of acquiring a customer",
                "The time it takes to close a deal",
              ],
              correct: 1,
              explanation:
                "CLV represents the total revenue expected from a customer throughout their entire relationship with the company, which is crucial in recurring revenue models.",
            },
            {
              question: "Why is consultative selling essential in software sales?",
              options: [
                "It's faster than traditional selling",
                "It requires less product knowledge",
                "It helps understand and address specific business needs",
                "It eliminates the need for demos",
              ],
              correct: 2,
              explanation:
                "Consultative selling helps sales professionals understand specific customer challenges and craft customized solutions that address unique business needs.",
            },
            {
              question: "What is the most important factor when demonstrating software to prospects?",
              options: [
                "Showing all available features",
                "Focusing on technical specifications",
                "Connecting features to business outcomes",
                "Comparing with competitors",
              ],
              correct: 2,
              explanation:
                "Successful software demos connect product features to specific business outcomes and value that the prospect will realize.",
            },
            {
              question: "Which factor most significantly extends software sales cycles in India?",
              options: [
                "Product complexity",
                "Multiple stakeholder involvement and approval processes",
                "High prices",
                "Limited vendor options",
              ],
              correct: 1,
              explanation:
                "Multiple stakeholders with different priorities and multi-layered approval processes significantly extend sales cycles in Indian organizations.",
            },
          ],
        },
        {
          id: 2,
          title: "B2B vs B2C Sales Approaches",
          duration: "22 min read",
          content: {
            lesson: `
                            <h1>B2B vs B2C Sales Approaches in Software</h1>
                            
                            <p>Understanding the fundamental differences between Business-to-Business (B2B) and Business-to-Consumer (B2C) sales approaches is crucial for software sales professionals. Each requires distinct strategies, skills, and mindsets to achieve success in the Indian market.</p>
                            
                            <h2>Fundamental Differences Overview</h2>
                            
                            <div class="comparison-table">
                                <h3>B2B vs B2C: Core Distinctions</h3>
                                
                                <h4>Decision-Making Process</h4>
                                <p><strong>B2B:</strong> Complex, multi-stakeholder decisions involving committees, extensive evaluation periods, and formal approval processes. In Indian enterprises, this often includes multiple hierarchical levels.</p>
                                
                                <p><strong>B2C:</strong> Individual or household decisions, typically faster and more emotional, with fewer people involved in the final choice.</p>
                                
                                <h4>Purchase Motivation</h4>
                                <p><strong>B2B:</strong> Driven by business needs, ROI calculations, efficiency improvements, competitive advantage, and problem-solving requirements.</p>
                                
                                <p><strong>B2C:</strong> Motivated by personal needs, desires, convenience, status, entertainment, or lifestyle enhancement.</p>
                                
                                <h4>Relationship Duration</h4>
                                <p><strong>B2B:</strong> Long-term partnerships spanning years, with ongoing support, renewals, and expansion opportunities.</p>
                                
                                <p><strong>B2C:</strong> Often transactional, though some products build long-term brand loyalty.</p>
                            </div>
                            
                            <h2>B2B Software Sales Deep Dive</h2>
                            
                            <h3>The B2B Buying Committee</h3>
                            <p>In Indian B2B software sales, understanding the buying committee structure is essential:</p>
                            
                            <ul>
                                <li><strong>Economic Buyer:</strong> Has budget authority and final approval power (often C-level executives)</li>
                                <li><strong>Technical Buyer:</strong> Evaluates technical fit and integration capabilities (CTO, IT Director)</li>
                                <li><strong>User Buyer:</strong> Will actually use the software daily (department heads, team leads)</li>
                                <li><strong>Coach:</strong> Internal advocate who guides you through the organization</li>
                                <li><strong>Influencer:</strong> Provides input and recommendations but doesn't make final decisions</li>
                            </ul>
                            
                            <h3>B2B Sales Cycle Characteristics</h3>
                            <p>B2B software sales in India typically follow this extended process:</p>
                            
                            <ol>
                                <li><strong>Problem Recognition (Weeks 1-4):</strong> Organization identifies business challenge</li>
                                <li><strong>Solution Research (Weeks 5-12):</strong> Team researches available options and vendors</li>
                                <li><strong>Vendor Evaluation (Weeks 13-20):</strong> RFP process, demos, and detailed assessments</li>
                                <li><strong>Proposal & Negotiation (Weeks 21-28):</strong> Contract terms, pricing, and implementation planning</li>
                                <li><strong>Final Approval (Weeks 29-32):</strong> Executive sign-off and legal review</li>
                                <li><strong>Implementation Planning (Weeks 33-36):</strong> Project kickoff and timeline establishment</li>
                            </ol>
                            
                            <div class="indian-context">
                                <h3>B2B Sales in Indian Context</h3>
                                <p>Indian B2B sales have unique characteristics:</p>
                                <ul>
                                    <li><strong>Hierarchy Respect:</strong> Decision-making follows organizational hierarchy strictly</li>
                                    <li><strong>Relationship Building:</strong> Personal relationships often precede business discussions</li>
                                    <li><strong>Risk Aversion:</strong> Conservative approach to new technology adoption</li>
                                    <li><strong>Cost Justification:</strong> Extensive ROI analysis and budget scrutiny</li>
                                    <li><strong>Reference Importance:</strong> Strong preference for vendors with local success stories</li>
                                </ul>
                            </div>
                            
                            <div class="key-takeaways">
                                <h3>Key Takeaways</h3>
                                <ul>
                                    <li>B2B sales require longer relationship building and complex stakeholder management</li>
                                    <li>B2C sales focus on emotional connection and simplified value propositions</li>
                                    <li>Decision-making processes differ significantly between business and consumer buyers</li>
                                    <li>Communication styles must adapt to audience expectations and preferences</li>
                                    <li>Pricing strategies should reflect the different value perceptions of each market</li>
                                    <li>Success metrics vary based on the sales model and customer type</li>
                                    <li>Indian market characteristics influence both B2B and B2C approaches differently</li>
                                </ul>
                            </div>
                        `,
          },
          quiz: [
            {
              question: "What is the primary difference in decision-making between B2B and B2C software sales?",
              options: [
                "B2B decisions are always faster",
                "B2C involves more stakeholders",
                "B2B involves multiple stakeholders and longer evaluation periods",
                "B2C requires more technical evaluation",
              ],
              correct: 2,
              explanation:
                "B2B decisions typically involve multiple stakeholders, committees, and extended evaluation periods, while B2C decisions are usually made by individuals or small groups more quickly.",
            },
            {
              question: "In Indian B2B software sales, who typically has the final budget authority?",
              options: ["IT Director", "End users", "Economic Buyer (often C-level executives)", "Procurement team"],
              correct: 2,
              explanation:
                "The Economic Buyer, often a C-level executive, has the final budget authority and approval power in B2B software purchases.",
            },
            {
              question: "What is the typical B2B software sales cycle length in India?",
              options: ["1-4 weeks", "8-36 weeks", "1-2 weeks", "52+ weeks"],
              correct: 1,
              explanation:
                "B2B software sales cycles in India typically range from 8-36 weeks (2-9 months) due to complex evaluation processes and multiple stakeholder involvement.",
            },
            {
              question: "Which psychological factor is most important in B2C software sales?",
              options: [
                "Technical specifications",
                "ROI calculations",
                "Emotional connection and immediate gratification",
                "Integration capabilities",
              ],
              correct: 2,
              explanation:
                "B2C software sales rely heavily on emotional connection and the promise of immediate gratification, unlike B2B sales which focus on rational business benefits.",
            },
            {
              question: "What pricing strategy is most effective for B2C software?",
              options: [
                "Custom enterprise pricing",
                "Value-based pricing with ROI calculations",
                "Psychological pricing with freemium models",
                "Annual contract pricing only",
              ],
              correct: 2,
              explanation:
                "B2C software benefits from psychological pricing (like ₹999 instead of ₹1000) and freemium models that lower the barrier to entry.",
            },
          ],
        },
      ],
    },
    {
      id: 2,
      title: "Prospecting & Lead Generation",
      icon: "fas fa-search",
      chapters: [
        {
          id: 1,
          title: "LinkedIn Outreach Strategies",
          duration: "30 min read",
          content: {
            lesson: `
                            <h1>LinkedIn Outreach Strategies for Software Sales</h1>
                            
                            <p>LinkedIn has emerged as the most powerful platform for B2B software sales professionals, particularly in the Indian market where professional networking and relationship-building are crucial for success. With over 100 million users in India, LinkedIn provides unprecedented access to decision-makers and influencers across industries.</p>
                            
                            <h2>Why LinkedIn Dominates B2B Software Sales</h2>
                            
                            <p>LinkedIn's effectiveness in software sales stems from several unique advantages:</p>
                            
                            <h3>Professional Context and Intent</h3>
                            <ul>
                                <li><strong>Business Mindset:</strong> Users are in a professional mindset, making them more receptive to business conversations</li>
                                <li><strong>Decision-Maker Concentration:</strong> 80% of B2B leads come from LinkedIn, with 4 out of 5 LinkedIn users driving business decisions</li>
                                <li><strong>Industry Insights:</strong> Rich professional data helps identify prospects' challenges and priorities</li>
                                <li><strong>Warm Introductions:</strong> Mutual connections provide credibility and trust</li>
                            </ul>
                            
                            <div class="key-takeaways">
                                <h3>Key Takeaways</h3>
                                <ul>
                                    <li>LinkedIn is the most effective platform for B2B software sales in India</li>
                                    <li>Profile optimization is crucial for credibility and search visibility</li>
                                    <li>Personalized connection requests have 3x higher acceptance rates</li>
                                    <li>Strategic follow-up sequences build relationships and generate opportunities</li>
                                    <li>Content creation establishes thought leadership and attracts prospects</li>
                                    <li>Consistent daily activity and systematic processes drive results</li>
                                    <li>Measuring and optimizing performance is essential for continuous improvement</li>
                                </ul>
                            </div>
                        `,
          },
          quiz: [
            {
              question: "What percentage of B2B leads come from LinkedIn according to industry research?",
              options: ["60%", "70%", "80%", "90%"],
              correct: 2,
              explanation:
                "According to industry research, 80% of B2B leads come from LinkedIn, making it the most important platform for B2B sales professionals.",
            },
            {
              question: "What are the peak activity times for LinkedIn engagement in India?",
              options: [
                "6-8 AM and 12-2 PM IST",
                "9-11 AM and 6-8 PM IST",
                "2-4 PM and 10-12 PM IST",
                "8-10 AM and 4-6 PM IST",
              ],
              correct: 1,
              explanation:
                "Peak LinkedIn activity times in India are 9-11 AM and 6-8 PM IST, when professionals are most active on the platform.",
            },
          ],
        },
      ],
    },
  ],
}

// Application State
let currentUser = {
  name: "Guest",
  email: "",
  company: "",
  role: "",
  progress: {},
  notes: {},
  bookmarks: [],
  completedExercises: {},
}

let currentModule = null
let currentChapter = null
let currentView = "home"

// Initialize Application
document.addEventListener("DOMContentLoaded", () => {
  loadUserData()
  initializeEventListeners()
  showView("home")
  updateHeaderInfo()
})

// Event Listeners
function initializeEventListeners() {
  // Navigation
  document.getElementById("homeBtn").addEventListener("click", () => showView("home"))
  document.getElementById("learningBtn").addEventListener("click", () => showView("learning"))
  document.getElementById("progressBtn").addEventListener("click", () => showView("progress"))
  document.getElementById("profileBtn").addEventListener("click", () => showView("profile"))
  document.getElementById("certificateBtn").addEventListener("click", () => showView("certificate"))

  // Home page start learning button
  document.getElementById("startLearningBtn").addEventListener("click", () => showView("learning"))

  // Chapter navigation
  document.getElementById("backToLearningBtn").addEventListener("click", () => showView("learning"))
  document.getElementById("takeQuizBtn").addEventListener("click", showQuiz)

  // Profile management
  document.getElementById("saveProfileBtn").addEventListener("click", saveProfile)

  // Notes and bookmarks
  document.getElementById("saveNotesBtn").addEventListener("click", saveNotes)
  document.getElementById("bookmarkBtn").addEventListener("click", toggleBookmark)

  // Modal close
  document.getElementById("closeQuizModal").addEventListener("click", closeQuizModal)

  // Close modals when clicking outside
  window.addEventListener("click", (event) => {
    if (event.target.classList.contains("modal")) {
      closeQuizModal()
    }
  })
}

// View Management
function showView(viewName) {
  // Hide all views
  document.querySelectorAll(".view").forEach((view) => view.classList.remove("active"))
  document.querySelectorAll(".nav-btn").forEach((btn) => btn.classList.remove("active"))

  // Show selected view
  document.getElementById(viewName + "View").classList.add("active")
  document.getElementById(viewName + "Btn").classList.add("active")

  currentView = viewName

  // Load view-specific content
  switch (viewName) {
    case "learning":
      renderLearningDashboard()
      break
    case "progress":
      renderProgressDashboard()
      break
    case "profile":
      loadProfileData()
      renderProfileStats()
      break
    case "certificate":
      renderCertificate()
      break
  }
}

// Learning Dashboard
function renderLearningDashboard() {
  const modulesGrid = document.getElementById("modulesGrid")
  modulesGrid.innerHTML = ""

  courseData.modules.forEach((module) => {
    const moduleCard = createModuleCard(module)
    modulesGrid.appendChild(moduleCard)
  })
}

function createModuleCard(module) {
  const card = document.createElement("div")
  card.className = "module-card"

  const completedChapters = getCompletedChapters(module.id)
  const totalChapters = module.chapters.length
  const progressPercent = (completedChapters / totalChapters) * 100

  card.innerHTML = `
        <div class="module-header">
            <div class="module-icon">
                <i class="${module.icon}"></i>
            </div>
            <div class="module-info">
                <h3>${module.title}</h3>
                <div class="module-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${progressPercent}%"></div>
                    </div>
                    <span>${completedChapters}/${totalChapters} chapters completed (${Math.round(progressPercent)}%)</span>
                </div>
            </div>
        </div>
        <ul class="chapters-list">
            ${module.chapters.map((chapter) => createChapterItem(module.id, chapter)).join("")}
        </ul>
    `

  return card
}

function createChapterItem(moduleId, chapter) {
  const isCompleted = isChapterCompleted(moduleId, chapter.id)
  const isLocked = isChapterLocked(moduleId, chapter.id)
  const status = isCompleted ? "completed" : isLocked ? "locked" : "available"

  const statusIcon = isCompleted ? "fas fa-check-circle" : isLocked ? "fas fa-lock" : "fas fa-play-circle"

  return `
        <li class="chapter-item ${status}" onclick="openChapter(${moduleId}, ${chapter.id})">
            <div class="chapter-status">
                <i class="${statusIcon}"></i>
            </div>
            <div class="chapter-title">${chapter.title}</div>
            <div class="chapter-duration">${chapter.duration}</div>
        </li>
    `
}

// Progress Dashboard
function renderProgressDashboard() {
  const dashboard = document.getElementById("progressDashboard")
  const totalChapters = courseData.modules.reduce((sum, module) => sum + module.chapters.length, 0)
  const completedChapters = Object.keys(currentUser.progress).length
  const overallProgress = totalChapters > 0 ? (completedChapters / totalChapters) * 100 : 0

  dashboard.innerHTML = `
        <div class="progress-overview">
            <h2>Overall Progress</h2>
            <div class="overall-progress">
                <div class="progress-circle-large" style="background: conic-gradient(#0056b3 ${overallProgress * 3.6}deg, #e0e0e0 0deg)">
                    <div class="progress-percentage">${Math.round(overallProgress)}%</div>
                </div>
                <p>${completedChapters} of ${totalChapters} chapters completed</p>
            </div>
        </div>
        
        <div class="modules-progress">
            ${courseData.modules.map((module) => createModuleProgressCard(module)).join("")}
        </div>
    `
}

function createModuleProgressCard(module) {
  const completedChapters = getCompletedChapters(module.id)
  const totalChapters = module.chapters.length
  const progressPercent = (completedChapters / totalChapters) * 100

  return `
        <div class="module-progress-card">
            <h3><i class="${module.icon}"></i> ${module.title}</h3>
            <div class="progress-bar">
                <div class="progress-fill" style="width: ${progressPercent}%"></div>
            </div>
            <p>${completedChapters}/${totalChapters} chapters (${Math.round(progressPercent)}%)</p>
        </div>
    `
}

// Profile Management
function loadProfileData() {
  document.getElementById("profileName").value = currentUser.name || ""
  document.getElementById("profileEmail").value = currentUser.email || ""
  document.getElementById("profileCompany").value = currentUser.company || ""
  document.getElementById("profileRole").value = currentUser.role || ""
}

function saveProfile() {
  currentUser.name = document.getElementById("profileName").value || "Guest"
  currentUser.email = document.getElementById("profileEmail").value || ""
  currentUser.company = document.getElementById("profileCompany").value || ""
  currentUser.role = document.getElementById("profileRole").value || ""

  saveUserData()
  updateHeaderInfo()
  alert("Profile saved successfully!")
}

function renderProfileStats() {
  const statsContainer = document.getElementById("profileStats")
  const totalChapters = courseData.modules.reduce((sum, module) => sum + module.chapters.length, 0)
  const completedChapters = Object.keys(currentUser.progress).length
  const bookmarksCount = currentUser.bookmarks.length
  const notesCount = Object.keys(currentUser.notes).length

  statsContainer.innerHTML = `
        <div class="stat-item">
            <div class="stat-value">${completedChapters}</div>
            <div class="stat-label">Chapters Completed</div>
        </div>
        <div class="stat-item">
            <div class="stat-value">${Math.round((completedChapters / totalChapters) * 100)}%</div>
            <div class="stat-label">Course Progress</div>
        </div>
        <div class="stat-item">
            <div class="stat-value">${bookmarksCount}</div>
            <div class="stat-label">Bookmarks</div>
        </div>
        <div class="stat-item">
            <div class="stat-value">${notesCount}</div>
            <div class="stat-label">Notes Taken</div>
        </div>
    `
}

// Chapter Management
function openChapter(moduleId, chapterId) {
  if (isChapterLocked(moduleId, chapterId)) {
    alert("Complete the previous chapter quiz to unlock this chapter.")
    return
  }

  currentModule = courseData.modules.find((m) => m.id === moduleId)
  currentChapter = currentModule.chapters.find((c) => c.id === chapterId)

  renderChapter()
  showView("chapter")
}

function renderChapter() {
  document.getElementById("chapterTitle").textContent = `${currentModule.title} - ${currentChapter.title}`
  document.getElementById("chapterDuration").textContent = currentChapter.duration

  renderChapterNavigation()
  renderLessonContent()
  loadChapterNotes()
  updateBookmarkButton()
}

function renderChapterNavigation() {
  const nav = document.getElementById("chapterNav")
  nav.innerHTML = `
        <h3>Chapter Contents</h3>
        <div class="nav-item active">
            <i class="fas fa-book"></i> Lesson Content
        </div>
        <div class="nav-item">
            <i class="fas fa-question-circle"></i> Take Quiz
        </div>
    `
}

function renderLessonContent() {
  const content = document.getElementById("lessonContent")
  content.innerHTML = currentChapter.content.lesson
}

// Quiz System
function showQuiz() {
  const modal = document.getElementById("quizModal")
  const modalBody = document.getElementById("quizModalBody")
  const quizTitle = document.getElementById("quizTitle")

  quizTitle.textContent = `${currentChapter.title} - Quiz`
  modalBody.innerHTML = renderQuizQuestions()
  modal.style.display = "block"
}

function renderQuizQuestions() {
  const questions = currentChapter.quiz
  let html = `
        <p>Answer all questions to complete this chapter. You need 60% to pass.</p>
        <div class="quiz-questions">
    `

  questions.forEach((question, index) => {
    html += `
            <div class="quiz-question">
                <h3>Question ${index + 1}: ${question.question}</h3>
                <ul class="quiz-options">
                    ${question.options
                      .map(
                        (option, optIndex) => `
                        <li class="quiz-option">
                            <label>
                                <input type="radio" name="question_${index}" value="${optIndex}">
                                ${option}
                            </label>
                        </li>
                    `,
                      )
                      .join("")}
                </ul>
                <div id="result_${index}" class="quiz-result hidden"></div>
            </div>
        `
  })

  html += `
        </div>
        <div style="text-align: center; margin-top: 2rem;">
            <button class="btn-primary" onclick="submitQuiz()">Submit Quiz</button>
        </div>
    `

  return html
}

function submitQuiz() {
  const questions = currentChapter.quiz
  let correctAnswers = 0
  let allAnswered = true
  const userAnswers = []

  questions.forEach((question, index) => {
    const selectedOption = document.querySelector(`input[name="question_${index}"]:checked`)
    const resultDiv = document.getElementById(`result_${index}`)

    if (!selectedOption) {
      allAnswered = false
      userAnswers.push(null)
      return
    }

    const selectedValue = Number.parseInt(selectedOption.value)
    userAnswers.push(selectedValue)
    const isCorrect = selectedValue === question.correct

    if (isCorrect) {
      correctAnswers++
      resultDiv.className = "quiz-result correct"
      resultDiv.textContent = "✓ Correct! " + question.explanation
    } else {
      resultDiv.className = "quiz-result incorrect"
      resultDiv.textContent = "✗ Incorrect. " + question.explanation
    }
    resultDiv.classList.remove("hidden")
  })

  if (!allAnswered) {
    alert("Please answer all questions before submitting.")
    return
  }

  const score = (correctAnswers / questions.length) * 100
  const passed = score >= 60

  // Show quiz results
  setTimeout(() => {
    if (passed) {
      const resultHtml = `
                <div class="quiz-score passed">
                    <h2>🎉 Congratulations!</h2>
                    <p>You scored ${Math.round(score)}% (${correctAnswers}/${questions.length} correct)</p>
                    <p>You passed! The next chapter is now unlocked.</p>
                    <div style="margin-top: 1rem;">
                        <button class="btn-primary" onclick="closeQuizModal(); showView('learning');">Continue Learning</button>
                    </div>
                </div>
            `

      document.getElementById("quizModalBody").innerHTML = resultHtml
      markChapterCompleted(currentModule.id, currentChapter.id)
      updateHeaderInfo()
    } else {
      // Show correct answers for failed quiz
      let answersReviewHtml = `
                <div class="quiz-score failed">
                    <h2>📚 Keep Learning!</h2>
                    <p>You scored ${Math.round(score)}% (${correctAnswers}/${questions.length} correct)</p>
                    <p>You need 60% to pass. Review the correct answers below and try again.</p>
                </div>
                
                <div class="quiz-answers-review">
                    <h3>Correct Answers Review</h3>
            `

      questions.forEach((question, index) => {
        const userAnswer = userAnswers[index]
        const isCorrect = userAnswer === question.correct

        answersReviewHtml += `
                    <div class="answer-review-item ${isCorrect ? "correct" : "incorrect"}">
                        <h4>Question ${index + 1}: ${question.question}</h4>
                        <div class="correct-answer">
                            ✓ Correct Answer: ${question.options[question.correct]}
                        </div>
                        ${
                          !isCorrect && userAnswer !== null
                            ? `
                            <div style="color: #dc3545; margin-bottom: 0.5rem;">
                                ✗ Your Answer: ${question.options[userAnswer]}
                            </div>
                        `
                            : ""
                        }
                        <div class="explanation">
                            ${question.explanation}
                        </div>
                    </div>
                `
      })

      answersReviewHtml += `
                </div>
                <div style="text-align: center; margin-top: 2rem;">
                    <button class="btn-primary" onclick="retakeQuiz()" style="margin-right: 1rem;">
                        <i class="fas fa-redo"></i> Retake Quiz
                    </button>
                    <button class="btn-secondary" onclick="closeQuizModal()">
                        <i class="fas fa-book"></i> Review Lesson
                    </button>
                </div>
            `

      document.getElementById("quizModalBody").innerHTML = answersReviewHtml
    }
  }, 2000)
}

function retakeQuiz() {
  // Reset quiz and show questions again
  const modalBody = document.getElementById("quizModalBody")
  modalBody.innerHTML = renderQuizQuestions()
}

function closeQuizModal() {
  document.getElementById("quizModal").style.display = "none"
}

// Progress Management
function isChapterCompleted(moduleId, chapterId) {
  return currentUser.progress[`${moduleId}_${chapterId}`] === true
}

function isChapterLocked(moduleId, chapterId) {
  if (chapterId === 1) return false // First chapter is always unlocked

  // Check if previous chapter is completed
  return !isChapterCompleted(moduleId, chapterId - 1)
}

function markChapterCompleted(moduleId, chapterId) {
  currentUser.progress[`${moduleId}_${chapterId}`] = true
  saveUserData()
}

function getCompletedChapters(moduleId) {
  const module = courseData.modules.find((m) => m.id === moduleId)
  return module.chapters.filter((chapter) => isChapterCompleted(moduleId, chapter.id)).length
}

function updateHeaderInfo() {
  document.getElementById("headerUserName").textContent = currentUser.name

  const totalChapters = courseData.modules.reduce((sum, module) => sum + module.chapters.length, 0)
  const completedChapters = Object.keys(currentUser.progress).length
  const progressPercent = totalChapters > 0 ? Math.round((completedChapters / totalChapters) * 100) : 0

  document.getElementById("headerProgress").textContent = `${progressPercent}%`
}

// Notes and Bookmarks
function saveNotes() {
  const notes = document.getElementById("notesArea").value
  const key = `${currentModule.id}_${currentChapter.id}`
  currentUser.notes[key] = notes
  saveUserData()
  alert("Notes saved successfully!")
}

function loadChapterNotes() {
  const key = `${currentModule.id}_${currentChapter.id}`
  const notes = currentUser.notes[key] || ""
  document.getElementById("notesArea").value = notes
}

function toggleBookmark() {
  const key = `${currentModule.id}_${currentChapter.id}`
  const index = currentUser.bookmarks.indexOf(key)

  if (index > -1) {
    currentUser.bookmarks.splice(index, 1)
    document.getElementById("bookmarkBtn").innerHTML = '<i class="fas fa-bookmark"></i> Bookmark'
  } else {
    currentUser.bookmarks.push(key)
    document.getElementById("bookmarkBtn").innerHTML = '<i class="fas fa-bookmark"></i> Bookmarked'
  }

  saveUserData()
}

function updateBookmarkButton() {
  const key = `${currentModule.id}_${currentChapter.id}`
  const isBookmarked = currentUser.bookmarks.includes(key)
  document.getElementById("bookmarkBtn").innerHTML = isBookmarked
    ? '<i class="fas fa-bookmark"></i> Bookmarked'
    : '<i class="fas fa-bookmark"></i> Bookmark'
}

// Certificate Generation
function renderCertificate() {
  const container = document.getElementById("certificateContainer")
  const totalChapters = courseData.modules.reduce((sum, module) => sum + module.chapters.length, 0)
  const completedChapters = Object.keys(currentUser.progress).length
  const isCompleted = completedChapters === totalChapters

  if (isCompleted) {
    container.innerHTML = `
            <div class="certificate">
                <h1>🏆 Certificate of Completion</h1>
                <h2>Software Sales Mastery Program</h2>
                <div class="certificate-content">
                    <p>This is to certify that</p>
                    <h3>${currentUser.name}</h3>
                    <p>has successfully completed the comprehensive</p>
                    <h3>Software Sales Professional Course</h3>
                    <p>Demonstrating mastery in:</p>
                    <ul style="text-align: left; max-width: 500px; margin: 1rem auto; list-style: none;">
                        <li>✓ Software Sales Fundamentals</li>
                        <li>✓ Prospecting & Lead Generation</li>
                        <li>✓ CRM Mastery</li>
                        <li>✓ Sales Negotiation & Closing</li>
                        <li>✓ Building Sales Networks</li>
                        <li>✓ Pipeline Management</li>
                    </ul>
                    <p><strong>Completion Date:</strong> ${new Date().toLocaleDateString()}</p>
                    <p><strong>Certificate ID:</strong> SA-${Date.now().toString().slice(-6)}</p>
                </div>
             
            </div>
        `
  } else {
    container.innerHTML = `
            <div style="text-align: center; padding: 3rem;">
                <i class="fas fa-certificate" style="font-size: 4rem; color: #ccc; margin-bottom: 2rem;"></i>
                <h2>Certificate Not Yet Available</h2>
                <p>Complete all ${totalChapters} chapters to earn your certificate.</p>
                <div style="margin: 2rem 0;">
                    <div class="progress-bar" style="max-width: 400px; margin: 0 auto;">
                        <div class="progress-fill" style="width: ${(completedChapters / totalChapters) * 100}%"></div>
                    </div>
                    <p style="margin-top: 1rem;">${completedChapters}/${totalChapters} chapters completed</p>
                </div>
                <button class="btn-primary" onclick="showView('learning')">Continue Learning</button>
            </div>
        `
  }
}

function downloadCertificate() {
  alert("Certificate download feature would be implemented with PDF generation in production.")
}

// Data Management
function saveUserData() {
  localStorage.setItem("salesAcademyUser", JSON.stringify(currentUser))
}

function loadUserData() {
  const saved = localStorage.getItem("salesAcademyUser")
  if (saved) {
    currentUser = { ...currentUser, ...JSON.parse(saved) }
  }
}

// Initialize UI enhancements
function initializeUI() {
  // Add smooth scrolling
  document.documentElement.style.scrollBehavior = "smooth"

  // Add loading states for better UX
  document.addEventListener("click", (e) => {
    if (e.target.classList.contains("btn-primary") || e.target.classList.contains("btn-secondary")) {
      e.target.style.opacity = "0.7"
      setTimeout(() => {
        e.target.style.opacity = "1"
      }, 300)
    }
  })
}

// Call UI initialization
initializeUI()
